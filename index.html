<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lively-style Wallpaper (HTML/CSS)</title>

  <style>
    @font-face {
      font-family: "CustomTTC";
      src: url("font.ttc") format("truetype");
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    html,body{height:100%;margin:0;padding:0}
    body{
      overflow:hidden;
      background:#000;
      font-family: "CustomTTC", system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
      cursor: auto;
    }

    #bgVideo{
      position:fixed;
      top:50%;
      left:50%;
      width:110%;
      height:110%;
      min-width:110%;
      min-height:110%;
      transform:translate3d(-50%, -50%, 0);
      object-fit:cover;
      z-index:0;
      will-change: transform;
    }

    .clock-wrap{
      position:fixed;
      top:60px;
      left:50%;
      transform:translateX(-50%);
      z-index:2;
      pointer-events:none;
      text-align:center;
    }

    .clock-inner{
      position:relative;
      display:inline-block;
      padding:0 8px;
    }

    #weekday, #clock{
      color:#ffffff;
      text-shadow:0 2px 6px rgba(0,0,0,0.6);
      white-space:nowrap;
      position:relative;
    }

    #weekday{ font-size:30px; margin-bottom:8px; }
    #clock{ font-size:60px; letter-spacing:2px; font-weight:600; }

    #weekday span, #clock span{ display:inline-block; line-height:1; position:relative; }

    .ghost{
      position:absolute;
      top:0;
      left:0;
      pointer-events:none;
      user-select:none;
      white-space:nowrap;
      z-index:999;
      opacity:1;
      transition: opacity 0.6s ease, transform 0.6s ease;
      color: white;
    }

    :root{ --out-dur:0.6s; --in-dur:0.45s; }
    .fade-out-down{ animation: fadeOutDown var(--out-dur) forwards cubic-bezier(0.4,0,0.2,1); }
    .fade-in-up{ animation: fadeInUp var(--in-dur) forwards cubic-bezier(0.4,0,0.2,1); }

    @keyframes fadeOutDown{ 0%{opacity:1; transform:translateY(0);} 100%{opacity:0; transform:translateY(5px);} }
    @keyframes fadeInUp{ 0%{opacity:0; transform:translateY(-5px);} 100%{opacity:1; transform:translateY(0);} }

    @media (max-width:600px){ #clock{font-size:28px} #weekday{font-size:16px} }
  </style>
</head>
<body>

  <video id="bgVideo" preload="metadata" autoplay muted loop playsinline>
    <source src="background.mp4" type="video/mp4">
  </video>

  <div class="clock-wrap">
    <div class="clock-inner">
      <div id="weekday" aria-live="polite"></div>
      <div id="clock" aria-live="polite">--:--:--</div>
    </div>
  </div>

  <script>
    (function(){
      const el = document.getElementById('clock');
      const wd = document.getElementById('weekday');
      const bgVideo = document.getElementById('bgVideo');
      const weekdays = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
      function two(n){ return n<10?('0'+n):String(n); }

      function updatePerChar(element, newValue){
        const oldSpans = element.querySelectorAll('span');
        const oldValue = Array.from(oldSpans).map(s=>s.textContent).join('');
        const maxLen = Math.max(oldValue.length, newValue.length);

        let newHTML = '';
        for(let i=0;i<maxLen;i++){
          const oldC = oldValue[i] || '';
          const newC = newValue[i] || '';

          if(oldC === newC){
            newHTML += `<span>${newC}</span>`;
          } else {
            if(oldC){
              const ghost = document.createElement('span');
              ghost.className='ghost';
              ghost.textContent=oldC;
              element.appendChild(ghost);
              requestAnimationFrame(()=>{
                ghost.style.opacity='0';
                ghost.style.transform='translateY(5px)';
              });
              const outMs = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--out-dur')) * 1000 || 600;
              setTimeout(()=>{ ghost.remove(); }, outMs + 50);
            }
            newHTML += `<span class='fade-in-up'>${newC}</span>`;
          }
        }
        element.innerHTML = newHTML;
      }

      function update(){
        const now = new Date();
        updatePerChar(el, `${two(now.getHours())}:${two(now.getMinutes())}:${two(now.getSeconds())}`);
        updatePerChar(wd, weekdays[now.getDay()]);
      }

      const now0 = new Date();
      el.innerHTML = el.textContent.split('').map(c=>`<span>${c}</span>`).join('');
      wd.innerHTML = wd.textContent.split('').map(c=>`<span>${c}</span>`).join('');

      const delay = 1000 - (Date.now() % 1000);
      setTimeout(function(){ update(); setInterval(update, 1000); }, delay);

      // Mouse-following effect: faster when far, slower near target
      let mouseX = 0, mouseY = 0;
      let currentX = 0, currentY = 0;
      const sensitivity = 0.1;
      const maxSpeed = 4.0; // 最大速度
      const slowDistance = 270; // この距離で最大速度

      document.addEventListener('mousemove', e => {
        mouseX = (e.clientX - window.innerWidth/2) * sensitivity;
        mouseY = (e.clientY - window.innerHeight/2) * sensitivity;
      });

      function animate(){
        let dx = mouseX - currentX;
        let dy = mouseY - currentY;
        const dist = Math.sqrt(dx*dx + dy*dy);

        // 距離に応じて速度を調整: 近いほど遅く、遠いほど速く
        const speed = dist > slowDistance ? maxSpeed : (dist / slowDistance) * maxSpeed;
        if(dist > 0){
          currentX += dx / dist * speed;
          currentY += dy / dist * speed;
        }

        bgVideo.style.transform = `translate3d(calc(-50% + ${currentX}px), calc(-50% + ${currentY}px), 0)`;
        requestAnimationFrame(animate);
      }
      animate();
    })();
  </script>

</body>
</html>
